<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="../assets/imagens-hectare/favicon.png" type="image/x-icon">
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@200..700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/cadastrar-propriedade.css">
    <title>Cadastrar Propriedade</title>
</head>

<body>
    <div class="propriedade-container">
        <aside class="menu-lateral">
            <section class="sessao botoes-principais">
                <button class="botao-menu material-symbols-outlined">Account_Circle</button>
                <button class="botao-menu home material-symbols-outlined">Home</button>
                <button class="botao-menu material-symbols-outlined" onclick="navegar('ticket.html')">Headset</button>
            </section>
            <section class="sessao sair">
                <button class="botao-menu material-symbols-outlined"
                    onclick="navegar('../login/login.html')">Logout</button>
            </section>
        </aside>
        <aside class="caixa-conteudo">
            <header class="cabecalho">
                <div class="caixa-auxiliar-titulo-cabecalho">
                    <section class="sessao-voltar">
                        <span class="botao-cabecalho material-symbols-outlined" onclick="navegar('propriedade.html')">
                            Arrow_Back
                        </span>
                    </section>
                    <section class="sessao-titulo-cabecalho">
                        <h1>Cadastrar Propriedades</h1>
                    </section>
                    <section class="sessao-notificacao-cabecalho">
                        <span class="botao-cabecalho material-symbols-outlined"
                            onclick="mostrarNotificacoes()">Notifications</span>
                    </section>
                </div>
            </header>
            <div class="caixa-notificacoes" id="notificacoes">
                <header class="cabecalho-notificacoes">
                    <h4>Notificações</h4>
                    <h4 class="fechar-notificacoes" onclick="mostrarNotificacoes()">X</h4>
                </header>
                <section class="lista-notificacao">
                    <div class="notificacoes" id="notificacao1">
                        <span class="nivel-notificacao-ruim material-symbols-outlined">Warning</span>
                        <section class="descricao-notificacao">
                            <p onclick="excluirNotificacao(notificacao1)" class="excluir-notificacao">X</p>
                            <p>Hectare 1 está em estado de alerta!</p>
                            <p>16/05/2024</p>
                        </section>
                    </div>
                    <div class="notificacoes" id="notificacao2">
                        <span class="nivel-notificacao-ruim material-symbols-outlined">Warning</span>
                        <section class="descricao-notificacao">
                            <p onclick="excluirNotificacao(notificacao2)" class="excluir-notificacao">X</p>
                            <p>Hectare 2 está em estado de alerta!</p>
                            <p>16/05/2024</p>
                        </section>
                    </div>
                    <div class="notificacoes" id="notificacao3">
                        <span class="nivel-notificacao-medio material-symbols-outlined">Error</span>
                        <section class="descricao-notificacao">
                            <p onclick="excluirNotificacao(notificacao3)" class="excluir-notificacao">X</p>
                            <p>Hectare 4 está em estado de atenção!!</p>
                            <p>16/05/2024</p>
                        </section>
                    </div>
                    <div class="notificacoes" id="notificacao3">
                        <span class="nivel-notificacao-medio material-symbols-outlined">Error</span>
                        <section class="descricao-notificacao">
                            <p onclick="excluirNotificacao(notificacao3)" class="excluir-notificacao">X</p>
                            <p>Hectare 4 está em estado de atenção!!</p>
                            <p>16/05/2024</p>
                        </section>
                    </div>
                    <div class="notificacoes" id="notificacao3">
                        <span class="nivel-notificacao-medio material-symbols-outlined">Error</span>
                        <section class="descricao-notificacao">
                            <p onclick="excluirNotificacao(notificacao3)" class="excluir-notificacao">X</p>
                            <p>Hectare 4 está em estado de atenção!!</p>
                            <p>16/05/2024</p>
                        </section>
                    </div>
                    <div class="notificacoes" id="notificacao3">
                        <span class="nivel-notificacao-medio material-symbols-outlined">Error</span>
                        <section class="descricao-notificacao">
                            <p onclick="excluirNotificacao(notificacao3)" class="excluir-notificacao">X</p>
                            <p>Hectare 4 está em estado de atenção!!</p>
                            <p>16/05/2024</p>
                        </section>
                    </div>
                    <div class="notificacoes" id="notificacao3">
                        <span class="nivel-notificacao-medio material-symbols-outlined">Error</span>
                        <section class="descricao-notificacao">
                            <p onclick="excluirNotificacao(notificacao3)" class="excluir-notificacao">X</p>
                            <p>Hectare 4 está em estado de atenção!!</p>
                            <p>16/05/2024</p>
                        </section>
                    </div>
                </section>
            </div>
            <div class="conteudo">
                <section class="sessao-input-cadastro">
                    <h1 class="titulo-input-cadastro">Cadastre sua Propriedade</h1>
                    <div class="div-inputs">
                        <section class="sessao-inputs-esquerdo">
                            <b> Nome da Propriedade:</b>
                            <input class="input nome" id="input_idNomePropriedade" tabindex="1">

                            <b>Quantidade de Hectares:</b>
                            <input class="input email" id="input_idQTDhectare" tabindex="3">

                            <b>CEP Rural:</b>
                            <input type="text" class="input senha" id="input_idCEP" tabindex="5">

                        </section>
                        <section class="sessao-inputs-direito">
                            <b class="gambiarra">Cidade:</b>
                            <input class="input sobrenome" id="input_idCidade" tabindex="2">


                            <b class="gambiarra">Estado:</b>
                            <input class="input telefone" id="input_idEstado" tabindex="4">


                        </section>

                    </div>
                    <button class="botao-cadastrar" onclick="Cadastrar_Propriedade()" tabindex="7">CADASTRAR</button>
                    <p class="Campo_Aviso" id="Campo_Aviso"></p>
</body>

<script data-jsd-embedded data-key="5b0e0c87-af73-45fd-adc6-46268b98e4c6" data-base-url="https://jsd-widget.atlassian.com" src="https://jsd-widget.atlassian.com/assets/embed.js"></script>
</html>

<script>
    function Cadastrar_Propriedade() {
        let NomePropriedade = input_idNomePropriedade.value;
        let QTDhectare = input_idQTDhectare.value;
        let CEP = input_idCEP.value;
        let cidade = input_idCidade.value;
        let estado = input_idEstado.value;

        let QTD_Campos_Errados = 0;

        if (!NomePropriedade) {
            Campo_Aviso.innerHTML = `Preencha todos os campo `
            input_idNomePropriedade.style.border = "2px solid Red"
            QTD_Campos_Errados++
        }

        if (!QTDhectare) {
            Campo_Aviso.innerHTML = `Preencha todos os campo`
            input_idQTDhectare.style.border = "2px solid Red"
            QTD_Campos_Errados++
        }

        if (!CEP) {
            Campo_Aviso.innerHTML = `Preencha todos os campo `
            input_idCEP.style.border = "2px solid Red"
            QTD_Campos_Errados++

        }

        if (!cidade) {
            Campo_Aviso.innerHTML = `Preencha todos os campo `
            input_idCidade.style.border = "2px solid Red"
            QTD_Campos_Errados++

        }

        if (!estado) {
            Campo_Aviso.innerHTML = `Preencha todos os campo `
            input_idEstado.style.border = "2px solid Red"
            QTD_Campos_Errados++

        }

        if (QTD_Campos_Errados == 0) {
            fetch("/usuarios/InformacoesPropriedade", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({
                    NomePropriedadeServer: NomePropriedade,
                    QTDhectareServer:  QTDhectare,
                    CEPServer: CEP,
                    cidadeServer: cidade,
                    estadoServer: estado,
                    fkEmpresa: sessionStorage.fkEmpresa
                }),
            })

                .then(function (resposta) {
                    console.log("resposta: ", resposta);

                    if (resposta.ok) {

                        Campo_Aviso.innerHTML = `O cadastro foi realizado com sucesso!`
                        Campo_Aviso.style.color = "Green"

                        Cadastrar_Hectares()
                                         setTimeout(() => {
                            window.location.href = 'propriedade.html';
                        }, "2000");

                        limparFormulario();

                    } else {
                        throw "Houve um erro ao tentar realizar o cadastro!";
                    }
                })
                .catch(function (resposta) {
                    console.log(`#ERRO: ${resposta}`);

                });

            return false;


        }
    }

    function Cordenadas_Aleatorias() {
    const latitude = (Math.random() * 180 - 90).toFixed(6);
    const longitude = (Math.random() * 360 - 180).toFixed(6);

    return {
        latitude: parseFloat(latitude),
        longitude: parseFloat(longitude)
    };
}

    function Cadastrar_Hectares(){
        let QTDhectare = input_idQTDhectare.value;
        const Status = "Parado";
        const fkPropriedade = 2;
        
        for(let Numero_Hectare = 0; Numero_Hectare < QTDhectare; Numero_Hectare++){
            const Cordernadas = Cordenadas_Aleatorias();
            const latitude = Cordernadas.latitude;
            const longitude = Cordernadas.longitude;

            fetch("/usuarios/Cadastrar_Hectares", {
                  method: "POST",
                  headers: {
                    "Content-Type": "application/json",
                  },
                  body: JSON.stringify({
                    Status_Hectare:Status,
                    Latitude_Hectare:latitude ,
                    Longitude_Hectare:longitude,
                    FK_Propriedade:fkPropriedade
                  }),
                })
                  .then(function (resposta) {
                    console.log("resposta: ", resposta);

                    if (resposta.ok) {
                        resposta.json().then(json => {
                        console.log(json);
                        console.log(JSON.stringify(json));

                        
                        });

                    } else {
                      throw "Houve um erro ao tentar realizar ao buscar os usuarios";
                    }
                  })
                  .catch(function (resposta) {
                    console.log(`#ERRO: ${resposta}`);

                  });

                return false;
        }


    }

    // window.location.href = "./login"
</script>

